<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>মুভি ডাউনলোড ধাপ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; text-align: center; padding: 20px; }
    h1 { font-size: 22px; margin-bottom: 10px; }
    .step { display: none; }
    .step.active { display: block; }
    .download-banner { margin: 15px 0; }
    .download-banner img {
      width: 80%;
      max-width: 400px;
      cursor: pointer;
      border: 3px solid #444;
      border-radius: 10px;
    }
    .timer { font-size: 24px; color: #f55; margin: 10px 0; }
    button {
      padding: 10px 20px;
      font-size: 18px;
      background: crimson;
      color: white;
      border: none;
      cursor: pointer;
      display: none;
    }
  </style>
</head>
<body>

<h1>মুভি ডাউনলোডের পূর্বে নিচের ধাপগুলো সম্পন্ন করুন</h1>

<div id="steps">
  <div class="step" id="step1">
    <h2>Step 1 of 3</h2>
    <div class="download-banner">
      <a href="https://www.profitableratecpm.com/c6enwfc3?key=9791fdddf7df25d113a29cbf2c79dfdb" target="_blank" onclick="markAdDone(1)">
        <img src="Download.png" alt="Download">
      </a>
    </div>
    <div class="timer" id="timer1">২০</div>
    <button onclick="nextStep()">পরবর্তী ধাপ</button>
  </div>

  <div class="step" id="step2">
    <h2>Step 2 of 3</h2>
    <div class="download-banner">
      <a href="https://www.profitableratecpm.com/c6enwfc3?key=9791fdddf7df25d113a29cbf2c79dfdb" target="_blank" onclick="markAdDone(2)">
        <img src="Download.png" alt="Download">
      </a>
    </div>
    <div class="timer" id="timer2">২০</div>
    <button onclick="nextStep()">পরবর্তী ধাপ</button>
  </div>

  <div class="step" id="step3">
    <h2>Step 3 of 3</h2>
    <div class="download-banner">
      <a href="https://www.profitableratecpm.com/c6enwfc3?key=9791fdddf7df25d113a29cbf2c79dfdb" target="_blank" onclick="markAdDone(3)">
        <img src="Download.png" alt="Download">
      </a>
    </div>
    <div class="timer" id="timer3">২০</div>
    <button onclick="goToMain()">মূল পেজে যান</button>
  </div>
</div>

<script>
  const movieLinks = {
    "dkf83kdi2kdlsl2": "borbaad.html",
    "a7dks73djd": "https://mymoviesite.com/movies/pathaan.html"
  };

  const steps = document.querySelectorAll('.step');
  const params = new URLSearchParams(window.location.search);
  const ref = params.get("ref");
  let currentStep = 1;

  if (!ref || !movieLinks[ref]) {
    document.body.innerHTML = "<h2>ভুল বা মেয়াদোত্তীর্ণ লিংক!</h2>";
  } else {
    const savedStep = parseInt(sessionStorage.getItem("step")) || 1;
    currentStep = savedStep;
    showStep(currentStep);
    startTimer(currentStep);
  }

  function showStep(stepNum) {
    steps.forEach((step, index) => {
      step.classList.toggle("active", index === stepNum - 1);
    });
  }

  function startTimer(stepNum) {
    const timerEl = document.getElementById("timer" + stepNum);
    const btn = timerEl.nextElementSibling;
    let count = 20;
    timerEl.textContent = count;
    btn.style.display = "none";

    const countdown = setInterval(() => {
      count--;
      timerEl.textContent = count;
      if (count <= 0) {
        clearInterval(countdown);
        // Check if ad is already done
        if (sessionStorage.getItem("ad_done_step_" + stepNum) === "yes") {
          btn.style.display = "inline-block";
        }
      }
    }, 1000);
  }

  function markAdDone(stepNum) {
    sessionStorage.setItem("ad_done_step_" + stepNum, "yes");
  }

  function nextStep() {
    if (currentStep < 3) {
      currentStep++;
      sessionStorage.setItem("step", currentStep);
      showStep(currentStep);
      startTimer(currentStep);
    }
  }

  function goToMain() {
    sessionStorage.removeItem("step");
    window.location.href = movieLinks[ref];
  }
</script>

</body>
</html>
